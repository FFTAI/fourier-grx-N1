---
layout: default
title: 常用操作
nav_order: 5
has_toc: true
---

# 常用操作

* TOC
{:toc}

本文档介绍了使用 Fourier-GRX-N1 SDK 时的常用操作流程和注意事项。

## 固件安装和更新

Fourier-GRX-N1 SDK 安装文件请从 [固件更新](/docs/update) 下载。
下载完后，运行下面的指令完成安装过程：

```
# 安装 fourier-grx-xxx.deb 文件，安装完后系统中会提供 fourier-grx 程序工具
sudo dpkg -i fourier-grx-xxx.deb  # xxx 为具体版本号

# 安装 fourier-grx 完整内容
fourier-grx install
```

安装过程中，会要求输入机器人型号，请根据实际机器人型号进行配置，目前支持的型号如下：

| 机器人型号 | 机器人版本 | 测试机型 | [运行模式](/docs/usage#运行模式选择) | 适配的机器人型号 |
|-------|-------|------|----------------------------|----------|
| N1    | 无     | 否    | 开发者模式                      | N1       |

如若配置错误，可运行 `fourier-grx config` 进行重新配置。当前的配置信息可以通过 `fourier-grx list` 查看。

## 关节零位校准

> ℹ️ **说明**
>
> 使用内置校准任务，可以在【调试模式】下用手柄选中执行，也可以在【开发者模式】下通过调用对应任务接口执行。

### 启动前检查

1. **硬件检查**
    - ✅ 机器人电源已接通
    - ✅ 手柄正确连接
    - ✅ 网络连接正常
    - ✅ 插销已插入机器人关节定位孔

2. **软件准备**
    - ✅ SDK 已正确安装

### 启动程序

```bash
# 启动 Fourier-GRX 程序
fourier-grx start
```

### 校准流程

1. **操作步骤**
    - 使用手柄 L1 键选择 **校准任务**
    - 使用手柄 L2 键确认执行
    - 观察终端输出信息

校准任务对照表

| 机器人型号 | 校准任务          | 任务编号 | 说明      |
|-------|---------------|------|---------|
| N1    | TASK_SET_HOME | 999  | 全关节零位校准 |

2. **校准验证**
    - 成功标志
        - 终端显示 **全零数组**
        - 所有关节位置正确
    - 失败情况
        - 数组中出现大于 1 的值（意味着超过 1° 的关节偏差值）
        - 关节位置异常

3. **退出程序**

```bash
# 按两次 Ctrl+C 退出
⌨️ ctrl + c (×2)
```

### ⚠️ 重要注意事项

1. **插销管理**
    - 校准完成后必须拔出所有插销
    - 操作前检查插销是否完全移除
    - 如发现遗留插销，需重新校准

2. **安全预防**
    - 校准过程中保持安全距离
    - 确保紧急停止按钮可及
    - 观察机器人异常行为

3. **故障处理**
    - 校准失败时重新执行流程
    - 多次失败请联系技术支持
    - 记录错误信息以便分析

## 运行模式选择

在安装 `fourier-grx` 或是重新配置 `fourier-grx` 时，可以选择不同的运行模式。下面是一些相关指令：

- `fourier-grx list`：列出当前的配置参数，其中包括运行模式
- `fourier-grx install`：安装程序软件，安装过程中会提示选择运行模式
- `fourier-grx config`：重新配置启动参数

运行模式清单如下：

- ✅ 表示可用
- ❌ 表示不可用
- ⚠️ 表示尚未发布，功能不完整

| 编号 | 运行模式   | 配置值           | 说明                                     | 终端用户 | 开发用户 |
|----|--------|---------------|----------------------------------------|------|------|
| 1  | 发布模式   | release       | 适用于机器人出厂使用，默认使用 **掌机** 进行机器人控制         | ✅    | ❌    |
| 2  | 调试模式   | debug         | 适用于开发者调试使用，默认使用 **手柄** 进行机器人控制         | ❌    | ✅    |
| 3  | 遥操作模式  | teleoperation | 适用于开发者调试使用，默认使用 **Vision Pro** 进行机器人控制 | ❌    | ⚠️   |
| A  | 开发者模式  | sdk           | 适用于开发者使用 **SDK** 开发库调试使用               | ❌    | ✅    |
| B  | 离线调试模式 | offline       | 适用于 **离线** 调试使用，仅供内部测试使用               | ❌    | ❌    |

### 调试模式

调试模式下，机器人主要通过 **手柄**🎮 调用内部算法完成运动功能任务。
任务的切换使用手柄的 `L1`、`L2`、`R1`、`R2` 组合实现。
任务当前选中和确认的状态会在终端打印出来，如需查看，需通过终端窗口启动程序。

- `L1` 用于任务切换选择，`L2` 用于任务确认执行
- `R1` 用于模块切换选择，`R2` 用于模块确认执行

> ℹ️ **说明**：
>
> 关于任务和模块的具体描述，以及更多任务功能信息，请参阅 [参考指南 User 接口](/docs/reference/user) 的 `task/client 接口协议 (指令信息)` 章节的内容。

目前 Fourier N1 在调试模式下，可通过手柄调用的内部主要功能包括：

| 功能名称       | 任务编号 | 是否包含模块       | 说明             | 手柄快捷键              |
|------------|------|--------------|----------------|--------------------|
| 执行器失能（软急停） | 36   | 否            | 机器人全身执行器失能任务   | Logo<br/>(XBOX 键位) |
| 设置零位       | 999  | 否            | 全关节零位校准任务      |                    |
| 准备姿态       | 960  | 否            | 准备姿态任务         | A<br/>(XBOX 键位)    |
| 行走功能       | 965  | 是、包含多个上肢固定动作 | 站立、行走自然切换任务    | Y<br/>(XBOX 键位)    |
| 跑步功能       | 966  | 是、包含多个上肢固定动作 | 站立、行走、跑步自然切换任务 | B<br/>(XBOX 键位)    |

### 开发者模式

开发者模式下，用户可以参考开源开发接口进行二次开发，
具体的开发接口和示例程序可以参考：

- 开发接口：[参考指南](/docs/reference)
- 示例程序：[Wiki-GRx-Deploy](https://github.com/FFTAI/Wiki-GRx-Deploy)

## 程序开机自启动

fourier-grx 提供了程序开机自启动的配置功能，可以通过以下指令进行配置：

```bash
fourier-grx enable_service  # 开启程序开机自启动
fourier-grx disable_service # 关闭程序开机自启动
```

如果机器人已经配置为用手柄进行遥控操作。
开启开机自启动后，请确保机器人手柄在开机前已连接到主控电脑的 USB 端口，并处于唤醒状态。

## 启用/关闭 程序运行日志记录功能

fourier-grx 提供了程序运行日志记录功能，默认情况下是开启的，且不提供关闭功能。

如果一定希望关闭程序运行日志记录功能，可以修改程序启动脚本 `run.sh` 中的以下字段：

> ⚠️ **注意**：
>
> 修改该脚本会导致无法记录程序运行日志，可能会影响后续的调试和问题排查。

```bash
# 原始脚本内容
stdbuf -oL $FOURIER_GRX_HOME/run.bin --config=${config_file_path} \
| tee $FOURIER_GRX_HOME/log/${log_file_name}

# 修改后的脚本内容
stdbuf -oL $FOURIER_GRX_HOME/run.bin --config=${config_file_path} \
| tee /dev/null
```

## 启用/关闭 机器人数据日志记录功能

fourier-grx 提供了数据日志记录功能，但是默认情况下是关闭的，以减少对系统性能的影响。

如果需要启用数据日志记录功能，需要对 **配置文件** 进行手动修改，具体修改步骤如下：

1. 创建机器人的启动配置文件：
    - 打开文件夹 `~/fourier-grx/config/n1` 文件夹，找到当前使用的配置文件，比如 `config_N1__debug.yaml`。
    - 将该文件复制一份，命名为 `config_N1__record.yaml`。

2. 修改配置文件：
    - 打开 `config_N1__record.yaml` 文件。
    - 在配置文件中，添加以下内容：
        - 该配置表示在使用该配置文件启动 `fourier-grx` 时，启用数据记录功能，并将记录数据保存到指定路径。

   ```yaml
   record:
      enable: true
      path: "~/fourier-grx/record/n1"
   ```

3. 修改启动脚本：
    - 打开文件夹 `~/fourier-grx`，找到 `run.sh` 文件。
    - 找到 `run_type` 字段，将其修改为 `record`：

   ```bash
   run_type="record"
   ```

   > ⚠️ **注意**：
   >
   > 如果后续希望机器人恢复为正常的操作模式，可以通过 `fourier-grx config` 命令来修改配置文件，或是修改 `run.sh` 文件中的 `run_type` 字段为原来的值。

4. 启动机器人：
    - 此时，机器人将会在启动时启用数据记录功能，并将记录的数据保存到指定路径。

    ```bash
    # 在 终端1 中执行以下命令
    fourier-grx start
    ```

5. 数据分析：
    - 数据保存格式为 CSV 文件，可以使用 Excel 或其他数据分析工具进行分析。
    - Excel 导入时需要注意选择正确的分隔符（逗号）和编码格式（UTF-8）。
    - 数据文件中包含时间戳、关节角度、速度等信息，方便进行后续分析。
        - `Timestamp`: 时间戳
        - `jm_pos_{i}`: 关节 i 的测量位置
        - `jm_vel_{i}`: 关节 i 的测量速度
        - `jm_tor_{i}`: 关节 i 的测量扭矩
        - `jm_cur_{i}`: 关节 i 的测量电流
        - `jt_pos_{i}`: 关节 i 的目标位置
        - `jt_vel_{i}`: 关节 i 的目标速度
        - `jt_tor_{i}`: 关节 i 的目标扭矩
        - 关节序列参考 [关节序列](/docs/reference/joint_sequence) 文档。

> **说明**：
> 
> 如果需要关闭数据记录功能，可以将配置文件中的 `record.enable` 设置为 `false`，或是删除 `record` 字段。

